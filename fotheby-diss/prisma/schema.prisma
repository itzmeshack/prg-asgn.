
// CONFIGURATION

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}



// ENUMS


enum LotCategory {
  PAINTING
  DRAWING
  PHOTOGRAPH
  SCULPTURE
  CARVING
}



enum AuctionStatus {
  DRAFT
  SCHEDULED
  COMPLETED
  ARCHIVED
}

enum SubjectClassification {
  LANDSCAPE
  SEASCAPE
  PORTRAIT
  FIGURE
  STILL_LIFE
  NUDE
  ANIMAL
  ABSTRACT
  OTHER
}


enum LotStatus {
  DRAFT
  LISTED
  SOLD
  ARCHIVED
}


enum Role {
  STAFF
  PUBLIC
}




// CORE MODELS

model Auction {
  id          Int           @id @default(autoincrement())
  name        String
  auctionDate DateTime?
  status      AuctionStatus @default(DRAFT)
  archived    Boolean       @default(false)
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt

  lots        Lot[]
}


model Lot {
  id                Int      @id @default(autoincrement())
  lotNumber         String   @unique
  artistName        String
  yearProduced      Int
  subject           SubjectClassification
  description       String
  estimatedPrice    Float
  category           LotCategory
  status            LotStatus @default(DRAFT)
  archived          Boolean   @default(false)
  auctionId         Int?
  auction           Auction?  @relation(fields: [auctionId], references: [id])
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  images             LotImage[]
  paintingDetails   PaintingDetails?
  drawingDetails    DrawingDetails?
  photographDetails PhotographDetails?
  sculptureDetails  SculptureDetails?
  carvingDetails    CarvingDetails?
}


//images 


model LotImage {
  id         Int      @id @default(autoincrement())
  lotNumber  String
  filename   String
  createdAt  DateTime @default(now())

  lot Lot @relation(fields: [lotNumber], references: [lotNumber], onDelete: Cascade)

  @@index([lotNumber])
}



//CATEGORY DETAIL MODELS

model PaintingDetails {
  lotNumber  String   @id
  medium     String
  framed     Boolean
  heightCm   Decimal
  lengthCm   Decimal

  lot        Lot      @relation(fields: [lotNumber], references: [lotNumber], onDelete: Cascade)
}

model DrawingDetails {
  lotNumber  String   @id
  medium     String
  framed     Boolean
  heightCm   Decimal
  lengthCm   Decimal

  lot        Lot      @relation(fields: [lotNumber], references: [lotNumber], onDelete: Cascade)
}

model PhotographDetails {
  lotNumber  String   @id
  imageType  String
  heightCm   Decimal
  lengthCm   Decimal

  lot        Lot      @relation(fields: [lotNumber], references: [lotNumber], onDelete: Cascade)
}

model SculptureDetails {
  lotNumber  String   @id
  material   String
  heightCm   Decimal
  lengthCm   Decimal
  widthCm    Decimal
  weightKg   Decimal

  lot        Lot      @relation(fields: [lotNumber], references: [lotNumber], onDelete: Cascade)
}

model CarvingDetails {
  lotNumber  String   @id
  material   String
  heightCm   Decimal
  lengthCm   Decimal
  widthCm    Decimal
  weightKg   Decimal

  lot        Lot      @relation(fields: [lotNumber], references: [lotNumber], onDelete: Cascade)
}



model User {
  id            String    @id @default(cuid())
  name          String?
  email         String?   @unique
  emailVerified DateTime?
  image         String?

  role          Role      @default(PUBLIC)

  // Staff-only credentials (we use these for login)
  staffId       String?   @unique
  passwordHash  String?

  accounts      Account[]
  sessions      Session[]

  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
}

model Account {
  id                 String  @id @default(cuid())
  userId             String
  type               String
  provider           String
  providerAccountId  String
  refresh_token      String?
  access_token       String?
  expires_at         Int?
  token_type         String?
  scope              String?
  id_token           String?
  session_state      String?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}
